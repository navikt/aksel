import PT from 'prop-types';
import React, { Component } from 'react';
import sanitize from 'sanitize-html';
import { Normaltekst } from 'nav-frontend-typografi';

const leggTilLenkerTags = (innhold) => {
    const uriRegex = /(([\w-]+:\/\/?|www(?:-\w+)?\.)[^\s()<>]+\w)/g;
    const httpRegex = /^(https?):\/\/.*$/;

    return innhold.replace(uriRegex, (match) => {
        const matched = match.match(httpRegex) ? match : `http://${match}`;
        return `<a target="_blank" rel="noreferrer" href="${matched}">${matched}</a>`;
    });
};

const safeHtml = (content) => sanitize(content, { allowedTags: ['a'] });

const tilAvsnitt = (avsnitt, index, list) => (
    <Normaltekst
        className={index < list.length - 1 ? 'blokk-xs' : ''}
        dangerouslySetInnerHTML={{ __html: safeHtml(avsnitt) }} // eslint-disable-line react/no-danger
        key={index}
    />
);

class Tekstomrade extends Component { // eslint-disable-line react/prefer-stateless-function
    render() {
        const { children, ingenFormattering, ...props } = this.props;

        const tekst = children;
        const avsnitt = ingenFormattering ? tekst : tekst.split(/[\r\n]+/)
            .map(leggTilLenkerTags)
            .map(tilAvsnitt);

        return <div {...props}>{avsnitt}</div>;
    }
}

Tekstomrade.propTypes = {
    children: PT.string,
    ingenFormattering: PT.bool
};

Tekstomrade.defaultProps = {
    children: '',
    ingenFormattering: false
};

export default Tekstomrade;
