import PT from 'prop-types';
import React, { Component } from 'react';
import sanitize from 'sanitize-html';

const leggTilLenkerTags = (innhold) => {
    const uriRegex = /(([\w-]+:\/\/?|www(?:-\w+)?\.)[^\s()<>]+\w)/g;
    const httpRegex = /^(https?):\/\/.*$/;

    return innhold.replace(uriRegex, (match) => {
        const matched = match.match(httpRegex) ? match : `http://${match}`;
        return `<a target="_blank" href="${matched}">${matched}</a>`;
    });
};

const safeHtml = (content) => sanitize(content, { allowedTags: ['a'] });

const tilAvsnitt = (avsnitt, index) => (
    <p dangerouslySetInnerHTML={{ __html: safeHtml(avsnitt) }} key={index} /> // eslint-disable-line react/no-danger
);

class Tekstomrade extends Component { // eslint-disable-line react/prefer-stateless-function
    render() {
        const { children, ingenFormattering, ...props } = this.props;

        const tekst = children || '';
        const avsnitt = ingenFormattering ? tekst : tekst.split(/[\r\n]+/)
            .map(leggTilLenkerTags)
            .map(tilAvsnitt);

        return <div {...props}>{avsnitt}</div>;
    }
}

Tekstomrade.propTypes = {
    children: PT.string,
    ingenFormattering: PT.bool
};

export default Tekstomrade;
