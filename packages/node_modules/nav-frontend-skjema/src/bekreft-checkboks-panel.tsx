import * as React from 'react';
import * as classNames from 'classnames';
import * as PT from 'prop-types';
import { guid } from 'nav-frontend-js-utils';

export interface BekreftCheckboksPanelProps {
    /**
     * Callback-funksjon som blir kalt når checkboksen endrer state
     */
    onChange: (event: React.SyntheticEvent<EventTarget>) => void;
    /**
     * Default checked state for checkboksen
     */
    checked: boolean;
    /**
     * Tekst til høyre for checkboksen
     */
    label: string;
    /**
     * Tekst over checkboksen
     */
    children?: React.ReactNode | React.ReactChildren;
    /**
     * Øvrige custom props til <input>-elementet som ligger i bunn
     */
    inputProps?: React.InputHTMLAttributes<HTMLInputElement>;
    /**
     * Klassenavn
     */
    className?: string;
}

export interface State {
    hasFocus: boolean;
}

export class BekreftCheckboksPanel extends React.Component<BekreftCheckboksPanelProps, State> {
    private childrenId: string;

    constructor(props: BekreftCheckboksPanelProps) {
        super(props);
        this.state = { hasFocus: false };
        if (this.props.children) {
            this.childrenId = guid();
        }
    }

    toggleOutline() {
        return () => this.setState({ hasFocus: !this.state.hasFocus });
    }

    renderChildren() {
        const children = this.props.children;
        return children ? <div className="bekreftCheckboksPanel-innhold" id={this.childrenId}>{children}</div> : null;
    }

    render() {
        const { checked, onChange, label, inputProps, className } = this.props;
        const { hasFocus } = this.state;

        const cls = classNames('inputPanel bekreftCheckboksPanel', className, {
            'inputPanel--checked': checked,
            'inputPanel--focused': hasFocus
        });

        return (
            <div className={cls}>
                {this.renderChildren()}
                <label className="inputPanel__label">
                    <input
                        {...inputProps}
                        className="inputPanel__field"
                        type="checkbox"
                        checked={checked}
                        aria-checked={checked}
                        onFocus={this.toggleOutline()}
                        onBlur={this.toggleOutline()}
                        onChange={onChange}
                        aria-labelledby={this.childrenId}
                    />
                    <span className="inputPanel__textlabel">{label}</span>
                </label>
            </div>
        );
    }
}

(BekreftCheckboksPanel as React.ComponentClass).propTypes = {
    children: PT.node,
    className: PT.string,
    checked: PT.bool.isRequired,
    label: PT.string.isRequired,
    onChange: PT.func.isRequired
};

export default BekreftCheckboksPanel;
