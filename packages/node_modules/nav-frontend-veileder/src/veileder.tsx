import * as React from 'react';
import * as cn from 'classnames';

import { omit } from 'nav-frontend-js-utils';
// import NavVeilederSnakkeboble from './veileder-snakkeboble';

import 'nav-frontend-veileder-style'; // eslint-disable-line import/extensions

const cls = (props) => cn('nav-veileder', {
    'nav-veileder--advarsel': props.type === 'advarsel',
    'nav-veileder--feilmelding': props.type === 'feilmelding',
    'nav-veileder--suksess': props.type === 'suksess'
});

const frameCls = (props) => cn('nav-veileder__frame', {
    'nav-veileder__frame--sentrer': props.sentrer,
    'nav-veileder__frame--transparent': props.transparent,
    'nav-veileder__frame--utenmaske': props.utenMaske
});

export interface NavVeilederProps {
    bredde?: number;
    tekst?: React.ReactNode | React.ReactChild | React.ReactChildren;
    farge?: string;
    transparent?: boolean;
    utenMaske?: boolean;
    sentrer?: boolean;
    type?: 'normal' | 'suksess' | 'advarsel' | 'feilmelding';
};

interface FrameStyle {
    background?: string;
    width?: number;
    height?: number;
};

export interface NavVeilederSnakkebobleProps {
    tekst: React.ReactNode | React.ReactChild | React.ReactChildren;
    offset: number;
};

const NavVeilederSnakkeboble: React.StatelessComponent<NavVeilederSnakkebobleProps> = props => {
    const { tekst, offset } = props;

    const scaleMultiplier = Math.max(0.5, offset / 150);

    const bubbleStyles = {
        bottom: offset + ((20 * scaleMultiplier) / 2),
        marginRight: offset / 2
    };

    const arrowStyles = {
        bottom: Math.ceil(-20 - (((20 * scaleMultiplier) / 2) - 10)),
        right: ((20 - (20 * scaleMultiplier)) * -1) + (20 * scaleMultiplier),
        transform: `scale(${scaleMultiplier})`
    };

    return (
        <div className="nav-veileder__snakkeboble" style={bubbleStyles}>
            {tekst}
            <i className="nav-veileder__snakkeboblePil" style={arrowStyles} />
        </div>
    );
};

class NavVeileder extends React.Component<NavVeilederProps> { // eslint-disable-line react/prefer-stateless-function
    static defaultProps: Partial<NavVeilederProps> = {
        bredde: 230
    };

    getChatBubble(veilederBredde) {
        if (typeof this.props.tekst !== 'undefined' && this.props.tekst) {
            return <NavVeilederSnakkeboble tekst={this.props.tekst} offset={veilederBredde} />
        }
    }

    render() {
        const {
            children,
            tekst,
            farge,
            transparent,
            bredde,
            ...other
        } = this.props;

        const domProps = omit(
            { ...other },
            'sentrer',
            'utenMaske'
        );

        const frameStyles: FrameStyle = {};

        if (!transparent && farge) {
            frameStyles.background = farge;
        }

        if (bredde) {
            frameStyles.width = bredde;
            frameStyles.height = bredde;
        }

        return (
            <div className={cls(this.props)} {...domProps}>
                <div className={frameCls(this.props)} style={frameStyles}>{children}</div>
                {this.getChatBubble(bredde)}
            </div>
        );
    }
}

export default NavVeileder;
